<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker Compose and Multi-Container Apps | Ahmed Ayman</title><meta name=keywords content><meta name=description content="Diving with the Whale - Docker Day V - Docker Compose and Multi-Container Apps Author : Ahmed Ayman
Container Orchestration Container orchestration is the automatic process of managing or scheduling the work of individual containers for applications based on micro-services within multiple clusters. The widely deployed container orchestration platforms are based on open-source versions like Kubernetes, Docker Swarm or the commercial version from Red Hat Open-shift.
If you want to manage tens, hundreds, or even thousands of containers, you don&rsquo;t want to do that manually of course !"><meta name=author content="Ahmed Ayman"><link rel=canonical href=https://a7medayman6.github.io/blog/devops/diving-with-the-whale-docker-series/day-v/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.d9015f4cb657fd3539b79b29ffbd11de4175ccd105ad7591beffaadfafb48488.css integrity="sha256-2QFfTLZX/TU5t5sp/70R3kF1zNEFrXWRvv+q36+0hIg=" rel="preload stylesheet" as=style><link rel=preload href=profile-pic.jpeg as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><link rel=icon href=https://a7medayman6.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://a7medayman6.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://a7medayman6.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://a7medayman6.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://a7medayman6.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.68.3"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-123-45','auto');ga('send','pageview');}</script><meta property="og:title" content="Docker Compose and Multi-Container Apps"><meta property="og:description" content="Diving with the Whale - Docker Day V - Docker Compose and Multi-Container Apps Author : Ahmed Ayman
Container Orchestration Container orchestration is the automatic process of managing or scheduling the work of individual containers for applications based on micro-services within multiple clusters. The widely deployed container orchestration platforms are based on open-source versions like Kubernetes, Docker Swarm or the commercial version from Red Hat Open-shift.
If you want to manage tens, hundreds, or even thousands of containers, you don&rsquo;t want to do that manually of course !"><meta property="og:type" content="article"><meta property="og:url" content="https://a7medayman6.github.io/blog/devops/diving-with-the-whale-docker-series/day-v/"><meta property="og:image" content="https://a7medayman6.github.io/static/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-07-28T01:21:21+02:00"><meta property="article:modified_time" content="2021-07-28T01:21:21+02:00"><meta property="og:site_name" content="Ahmed Ayman"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://a7medayman6.github.io/static/"><meta name=twitter:title content="Docker Compose and Multi-Container Apps"><meta name=twitter:description content="Diving with the Whale - Docker Day V - Docker Compose and Multi-Container Apps Author : Ahmed Ayman
Container Orchestration Container orchestration is the automatic process of managing or scheduling the work of individual containers for applications based on micro-services within multiple clusters. The widely deployed container orchestration platforms are based on open-source versions like Kubernetes, Docker Swarm or the commercial version from Red Hat Open-shift.
If you want to manage tens, hundreds, or even thousands of containers, you don&rsquo;t want to do that manually of course !"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":4,"name":"Docker Compose and Multi-Container Apps","item":"https://a7medayman6.github.io/blog/devops/diving-with-the-whale-docker-series/day-v/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Docker Compose and Multi-Container Apps","name":"Docker Compose and Multi-Container Apps","description":"Diving with the Whale - Docker Day V - Docker Compose and Multi-Container Apps Author : Ahmed Ayman\nContainer Orchestration Container orchestration is the automatic process of managing or scheduling the work of individual containers for applications based on micro-services within multiple clusters. The widely deployed container orchestration platforms are based on open-source versions like Kubernetes, Docker Swarm or the commercial version from Red Hat Open-shift.\nIf you want to manage tens, hundreds, or even thousands of containers, you don\u0026rsquo;t want to do that manually of course !","keywords":[],"articleBody":"Diving with the Whale - Docker Day V - Docker Compose and Multi-Container Apps Author : Ahmed Ayman\nContainer Orchestration Container orchestration is the automatic process of managing or scheduling the work of individual containers for applications based on micro-services within multiple clusters. The widely deployed container orchestration platforms are based on open-source versions like Kubernetes, Docker Swarm or the commercial version from Red Hat Open-shift.\nIf you want to manage tens, hundreds, or even thousands of containers, you don’t want to do that manually of course ! That’s why we need container orchestration.\nMulti-Container Apps If you have multiple containers to run your app, for example you have the database in one container, and other back-end container, and front-end container, so you need to run all of these and connect them using networks and map the right ports and volumes and all that stuff! sounds like a lot of work right ?! here is where Docker Compose comes in the picture , it allows you to setup every thing in a yaml file then run only one command to start your multi-containers app!\nDocker Compose Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application’s services. Then, with a single command, you create and start all the services from your configuration. To learn more about all the features of Compose, see the list of features.\nIt’s basically composing the parts of the application and configuring them to work beautifully together with one command!\nIt simplifies the managing from multiple repeated commands to a yaml file and one command.\n  Install Docker Compose on Linux\nInstallation Guide From Docker Docs.\n Download the current stable release of Docker Compose  sudo curl -L \"https://github.com/docker/compose/releases/download/1.29.1/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose Apply executable permissions to the binary  sudo chmod +x /usr/local/bin/docker-compose and that’s it!\nCheck if the installation is successful  docker-compose --version # you should get smth like this # - docker-compose version 1.29.1, build 1110ad01   Docker-Compose YAML File\nDOCKER-COMPOSE YAML FILE CHEAT SHEET\nversion: \"3.9\" services: db: image: postgres volumes: - ./data/db:/var/lib/postgresql/data  environment: - POSTGRES_DB=postgres - POSTGRES_USER=postgres - POSTGRES_PASSWORD=postgres# docker run -v ./data/db:/var/lib/postgresql/data -e k=v postgres web: build: . command: python manage.py runserver 0.0.0.0:8000 volumes: - .:/code ports: - \"8000:8000\" depends_on: - db# docker build -t tag . # docker run tag -v .:/code -p 8000:8000 python manage.py runserver 0.0.0.0:8000This is a simple docker-compose yaml file for a sample django app that uses postgres database.\nso let’s break it down !\nversion: \"3.9\"Specifies the version of docker compose\nservices: db: web:it means we have two services, which is kinda means we have two docker images to build, one called db and the other called web\nlet’s dive into the db service\ndb: image: postgres volumes: - ./data/db:/var/lib/postgresql/data environment: - POSTGRES_DB=postgres - POSTGRES_USER=postgres - POSTGRES_PASSWORD=postgresimage defines the image we want to build from, and the same as docker run command, if the image doesn’t exist locally it’ll get downloaded from docker-hub, so here the image name is postgres\nvolumes defines the volume mapping rules so in this example we’re saying map ./data/db in the local host to /var/lib/postgresql/data in the container. It’s the same as running your container with docker run -v\nenvironment sets the environment variables for the container, the same as using -e when running your container with docker run, and it gets an array of key value pairs\nso to wrap it up, the db service says run a container from the image postgres, and map ./data/db in the host to /var/lib/postgresql/data in the container, and set POSTGRES_DB=postgres, POSTGRES_USER=postgres, POSTGRES_PASSWORD=postgres as env variables.\nif we want to translate it to a docker command it’ll be like this\n# create a env.list file contains all the env variables echo \"POSTGRES_DB=postgres \\nPOSTGRES_USER=postgres\\nPOSTGRES_PASSWORD=postgres\"  env.list docker run -v $(pwd)/data/db:/var/lib/postgresql/data --env-file env.list postgres now for the other service web, let’s break it down\nweb: build: . command: python manage.py runserver 0.0.0.0:8000 volumes: - .:/code ports: - \"8000:8000\" depends_on: - db build gets a path to the directory containing the docker file to build, so the difference between build and image is that image specifies an already built image, build specifies the docker-file to build an image from.\ncommand gets a Linux command , this overwrites the CMD command inside the docker file\nvolumes maps a host directory to container directory\nports maps/binds a host port to a container exposed port, so here we’re mapping port 8000 in the host machine to port 8000 in the container\ndepends_on specifies which services must be already running before running this container\nso let’s translate this service to a docker command\n# build the image docker build -t img . # run the container with the mapped port and volume docker run -p 8000:8000 -v $(pwd):/code img python manage.py runserver 0.0.0.0:8000 And there is so much more you can do with docker-compose yaml files.\n  Docker-Compose Commands\nRun Docker Compose Containers now that we have a docker-compose.yaml file we can run them using one command without paying attention to any mapping , and can get a specific service to start it only as an argument, if no arguments are specified all the services will start\n# change your directory to where the yaml file is cd docker-compose-test docker-compose up # thats it really! an important option of the up command is —scale=n this option will scale (i.e. will create more than 1 container from a specified service)\n# docker-compose up --scale $service=$n docker-compose up --scale web=5 and here is one of the powerful features of docker-compose!\nStop/Remove Docker Compose Containers this will stop all the running containers and removes containers, networks, volumes, and images created by up.\ndocker-compose down List Running Docker Compose Containers docker-compose ps Stop Docker Compose Containers this will stop all the containers created by up but will not remove anything, and can get a specific service to start it only as an argument, if no arguments are specified all the services will stop\ndocker-compose stop Start Docker Compose Containers this will start a docker compose existing containers and can get a specific service to start it only as an argument, if no arguments are specified all the services will start\ndocker-compose start Pause Docker Compose Containers this will pause all the containers created by up and can get a specific service to start it only as an argument, if no arguments are specified all the services will pause\ndocker-compose pause Un-pause Docker Compose Containers this will un-pause all the containers created by up and can get a specific service to start it only as an argument, if no arguments are specified all the services will un-pause\ndocker-compose unpause # [service, ...]   ","wordCount":"1115","inLanguage":"en","datePublished":"2021-07-28T01:21:21+02:00","dateModified":"2021-07-28T01:21:21+02:00","author":{"@type":"Person","name":"Ahmed Ayman"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://a7medayman6.github.io/blog/devops/diving-with-the-whale-docker-series/day-v/"},"publisher":{"@type":"Organization","name":"Ahmed Ayman","logo":{"@type":"ImageObject","url":"https://a7medayman6.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://a7medayman6.github.io/ accesskey=h title="Ahmed Ayman (Alt + H)">Ahmed Ayman</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://a7medayman6.github.io/about/ title=About><span>About</span></a></li><li><a href=https://a7medayman6.github.io/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://a7medayman6.github.io/blog/ title=Blog><span>Blog</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://a7medayman6.github.io/>Home</a></div><h1 class=post-title>Docker Compose and Multi-Container Apps</h1><div class=post-meta>July 28, 2021&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Ahmed Ayman</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#diving-with-the-whale---docker--day-v---docker-compose-and-multi-container-apps aria-label="Diving with the Whale - Docker  Day V - Docker Compose and Multi-Container Apps">Diving with the Whale - Docker Day V - Docker Compose and Multi-Container Apps</a></li><li><a href=#container-orchestration aria-label="Container Orchestration">Container Orchestration</a></li><li><a href=#multi-container-apps aria-label="Multi-Container Apps">Multi-Container Apps</a></li><li><a href=#docker-compose aria-label="Docker Compose">Docker Compose</a><ul><ul><li><a href=#run-docker-compose-containers aria-label="Run Docker Compose Containers">Run Docker Compose Containers</a></li><li><a href=#stopremove-docker-compose-containers aria-label="Stop/Remove Docker Compose Containers">Stop/Remove Docker Compose Containers</a></li><li><a href=#list-running-docker-compose-containers aria-label="List Running Docker Compose Containers">List Running Docker Compose Containers</a></li><li><a href=#stop-docker-compose-containers aria-label="Stop Docker Compose Containers">Stop Docker Compose Containers</a></li><li><a href=#start-docker-compose-containers aria-label="Start Docker Compose Containers">Start Docker Compose Containers</a></li><li><a href=#pause-docker-compose-containers aria-label="Pause Docker Compose Containers">Pause Docker Compose Containers</a></li><li><a href=#un-pause-docker-compose-containers aria-label="Un-pause Docker Compose Containers">Un-pause Docker Compose Containers</a></li></ul></ul></li></ul></div></details></div><div class=post-content><h1 id=diving-with-the-whale---docker--day-v---docker-compose-and-multi-container-apps>Diving with the Whale - Docker Day V - Docker Compose and Multi-Container Apps<a hidden class=anchor aria-hidden=true href=#diving-with-the-whale---docker--day-v---docker-compose-and-multi-container-apps>#</a></h1><p>Author : <a href=https://github.com/a7medayman6>Ahmed Ayman</a></p><h1 id=container-orchestration>Container Orchestration<a hidden class=anchor aria-hidden=true href=#container-orchestration>#</a></h1><p><strong>Container orchestration is the automatic process of managing or scheduling the work of individual containers for applications based on micro-services within multiple clusters. The widely deployed container orchestration platforms are based on open-source versions like Kubernetes, Docker Swarm or the commercial version from Red Hat Open-shift.</strong></p><p>If you want to manage tens, hundreds, or even thousands of containers, you don&rsquo;t want to do that manually of course ! That&rsquo;s why we need container orchestration.</p><h1 id=multi-container-apps>Multi-Container Apps<a hidden class=anchor aria-hidden=true href=#multi-container-apps>#</a></h1><p>If you have multiple containers to run your app, for example you have the database in one container, and other back-end container, and front-end container, so you need to run all of these and connect them using networks and map the right ports and volumes and all that stuff! sounds like a lot of work right ?! here is where Docker Compose comes in the picture , it allows you to setup every thing in a yaml file then run only one command to start your multi-containers app!</p><h1 id=docker-compose>Docker Compose<a hidden class=anchor aria-hidden=true href=#docker-compose>#</a></h1><p><strong>Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application’s services. Then, with a single command, you create and start all the services from your configuration. To learn more about all the features of Compose, see the list of features.</strong></p><p>It&rsquo;s basically composing the parts of the application and configuring them to work beautifully together with one command!</p><p>It simplifies the managing from multiple repeated commands to a yaml file and one command.</p><ul><li><p><strong>Install Docker Compose on Linux</strong></p><p><a href=https://docs.docker.com/compose/install/>Installation Guide From Docker Docs.</a></p><ol><li>Download the current stable release of Docker Compose</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo curl -L <span style=color:#e6db74>&#34;https://github.com/docker/compose/releases/download/1.29.1/docker-compose-</span><span style=color:#66d9ef>$(</span>uname -s<span style=color:#66d9ef>)</span><span style=color:#e6db74>-</span><span style=color:#66d9ef>$(</span>uname -m<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> -o /usr/local/bin/docker-compose
</code></pre></div><ol start=2><li>Apply executable permissions to the binary</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo chmod +x /usr/local/bin/docker-compose
</code></pre></div><p>and that&rsquo;s it!</p><ol start=3><li>Check if the installation is successful</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker-compose --version
<span style=color:#75715e># you should get smth like this</span>
<span style=color:#75715e># - docker-compose version 1.29.1, build 1110ad01</span>
</code></pre></div></li><li><p><strong>Docker-Compose YAML File</strong></p><p><strong><a href=https://devhints.io/docker-compose>DOCKER-COMPOSE YAML FILE CHEAT SHEET</a></strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker>version: <span style=color:#e6db74>&#34;3.9&#34;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>     <span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>services:<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>  db:<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    image: postgres<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    volumes:<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>      - ./data/db:/var/lib/postgresql/data <span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    environment:<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>      - POSTGRES_DB<span style=color:#f92672>=</span>postgres<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>      - POSTGRES_USER<span style=color:#f92672>=</span>postgres<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>      - POSTGRES_PASSWORD<span style=color:#f92672>=</span>postgres<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># docker run -v ./data/db:/var/lib/postgresql/data -e k=v postgres</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>  web:<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    build: .<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    command: python manage.py runserver 0.0.0.0:8000<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    volumes:<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>      - .:/code<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    ports:<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>      - <span style=color:#e6db74>&#34;8000:8000&#34;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    depends_on:<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>      - db<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># docker build -t tag . </span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># docker run tag -v .:/code -p 8000:8000 python manage.py runserver 0.0.0.0:8000</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>This is a simple docker-compose yaml file for a <a href=https://docs.docker.com/samples/django/>sample django app</a> that uses postgres database.</p><p>so let&rsquo;s break it down !</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker>version: <span style=color:#e6db74>&#34;3.9&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>Specifies the version of docker compose</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker>services:<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>  db:<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    web:<span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>it means we have two services, which is kinda means we have two docker images to build, one called db and the other called web</p><p>let&rsquo;s dive into the db service</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker>db:<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    image: postgres<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    volumes:<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>      - ./data/db:/var/lib/postgresql/data<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    environment:<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>      - POSTGRES_DB<span style=color:#f92672>=</span>postgres<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>      - POSTGRES_USER<span style=color:#f92672>=</span>postgres<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>      - POSTGRES_PASSWORD<span style=color:#f92672>=</span>postgres<span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p><strong>image</strong> defines the image we want to build from, and the same as docker run command, if the image doesn&rsquo;t exist locally it&rsquo;ll get downloaded from docker-hub, so here the image name is postgres</p><p><strong>volumes</strong> defines the volume mapping rules so in this example we&rsquo;re saying map ./data/db in the local host to /var/lib/postgresql/data in the container. It&rsquo;s the same as running your container with docker run -v</p><p><strong>environment</strong> sets the environment variables for the container, the same as using -e when running your container with docker run, and it gets an array of key value pairs</p><p>so to wrap it up, the db service says run a container from the image postgres, and map ./data/db in the host to /var/lib/postgresql/data in the container, and set POSTGRES_DB=postgres, POSTGRES_USER=postgres, POSTGRES_PASSWORD=postgres as env variables.</p><p>if we want to translate it to a docker command it&rsquo;ll be like this</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># create a env.list file contains all the env variables</span> 
echo <span style=color:#e6db74>&#34;POSTGRES_DB=postgres \nPOSTGRES_USER=postgres\nPOSTGRES_PASSWORD=postgres&#34;</span> &gt; env.list
docker run -v <span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span>/data/db:/var/lib/postgresql/data --env-file env.list postgres
</code></pre></div><p>now for the other service web, let&rsquo;s break it down</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>web:
    build: .
    command: python manage.py runserver 0.0.0.0:8000
    volumes:
      - .:/code
    ports:
      - <span style=color:#e6db74>&#34;8000:8000&#34;</span>
    depends_on:
      - db
</code></pre></div><p><strong>build</strong> gets a path to the directory containing the docker file to build, so the difference between build and image is that image specifies an already built image, build specifies the docker-file to build an image from.</p><p><strong>command</strong> gets a Linux command , this overwrites the CMD command inside the docker file</p><p><strong>volumes</strong> maps a host directory to container directory</p><p><strong>ports</strong> maps/binds a host port to a container exposed port, so here we&rsquo;re mapping port 8000 in the host machine to port 8000 in the container</p><p><strong>depends_on</strong> specifies which services must be already running before running this container</p><p>so let&rsquo;s translate this service to a docker command</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># build the image</span> 
docker build -t img .
<span style=color:#75715e># run the container with the mapped port and volume</span>
docker run -p 8000:8000 -v <span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span>:/code img python manage.py runserver 0.0.0.0:8000
</code></pre></div><p>And there is so much more you can do with docker-compose yaml files.</p></li><li><p><strong>Docker-Compose Commands</strong></p><h3 id=run-docker-compose-containers>Run Docker Compose Containers<a hidden class=anchor aria-hidden=true href=#run-docker-compose-containers>#</a></h3><p>now that we have a docker-compose.yaml file we can run them using one command without paying attention to any mapping , and can get a specific service to start it only as an argument, if no arguments are specified all the services will start</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># change your directory to where the yaml file is</span>
cd docker-compose-test 
docker-compose up 
<span style=color:#75715e># thats it really!</span>
</code></pre></div><p>an important option of the up command is —scale=n this option will scale (i.e. will create more than 1 container from a specified service)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># docker-compose up --scale $service=$n</span>
docker-compose up --scale web<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> 
</code></pre></div><p>and here is one of the powerful features of docker-compose!</p><h3 id=stopremove-docker-compose-containers>Stop/Remove Docker Compose Containers<a hidden class=anchor aria-hidden=true href=#stopremove-docker-compose-containers>#</a></h3><p>this will stop all the running containers and removes containers, networks, volumes, and images created by up.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker-compose down
</code></pre></div><h3 id=list-running-docker-compose-containers>List Running Docker Compose Containers<a hidden class=anchor aria-hidden=true href=#list-running-docker-compose-containers>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker-compose ps
</code></pre></div><h3 id=stop-docker-compose-containers>Stop Docker Compose Containers<a hidden class=anchor aria-hidden=true href=#stop-docker-compose-containers>#</a></h3><p>this will stop all the containers created by up but will not remove anything, and can get a specific service to start it only as an argument, if no arguments are specified all the services will stop</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker-compose stop
</code></pre></div><h3 id=start-docker-compose-containers>Start Docker Compose Containers<a hidden class=anchor aria-hidden=true href=#start-docker-compose-containers>#</a></h3><p>this will start a docker compose existing containers and can get a specific service to start it only as an argument, if no arguments are specified all the services will start</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker-compose start
</code></pre></div><h3 id=pause-docker-compose-containers>Pause Docker Compose Containers<a hidden class=anchor aria-hidden=true href=#pause-docker-compose-containers>#</a></h3><p>this will pause all the containers created by up and can get a specific service to start it only as an argument, if no arguments are specified all the services will pause</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker-compose pause
</code></pre></div><h3 id=un-pause-docker-compose-containers>Un-pause Docker Compose Containers<a hidden class=anchor aria-hidden=true href=#un-pause-docker-compose-containers>#</a></h3><p>this will un-pause all the containers created by up and can get a specific service to start it only as an argument, if no arguments are specified all the services will un-pause</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker-compose unpause <span style=color:#75715e># [service, ...]</span>
</code></pre></div></li></ul></div><footer class=post-footer><nav class=paginav><a class=prev href=https://a7medayman6.github.io/blog/devops/devops-lifecycle/><span class=title>« Prev Page</span><br><span>Devops Lifecycle</span></a>
<a class=next href=https://a7medayman6.github.io/blog/devops/jenkins/><span class=title>Next Page »</span><br><span>Jenkins</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Docker Compose and Multi-Container Apps on twitter" href="https://twitter.com/intent/tweet/?text=Docker%20Compose%20and%20Multi-Container%20Apps&url=https%3a%2f%2fa7medayman6.github.io%2fblog%2fdevops%2fdiving-with-the-whale-docker-series%2fday-v%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-253.927 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z" /></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Compose and Multi-Container Apps on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fa7medayman6.github.io%2fblog%2fdevops%2fdiving-with-the-whale-docker-series%2fday-v%2f&title=Docker%20Compose%20and%20Multi-Container%20Apps&summary=Docker%20Compose%20and%20Multi-Container%20Apps&source=https%3a%2f%2fa7medayman6.github.io%2fblog%2fdevops%2fdiving-with-the-whale-docker-series%2fday-v%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0v-129.439c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02v-126.056c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768h75.024zm-307.552-334.556c-25.674.0-42.448 16.879-42.448 39.002.0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z" /></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Compose and Multi-Container Apps on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fa7medayman6.github.io%2fblog%2fdevops%2fdiving-with-the-whale-docker-series%2fday-v%2f&title=Docker%20Compose%20and%20Multi-Container%20Apps"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zm-119.474 108.193c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zm-160.386-29.702c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z" /></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Compose and Multi-Container Apps on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fa7medayman6.github.io%2fblog%2fdevops%2fdiving-with-the-whale-docker-series%2fday-v%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978v-192.915h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892z" /></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Compose and Multi-Container Apps on whatsapp" href="https://api.whatsapp.com/send?text=Docker%20Compose%20and%20Multi-Container%20Apps%20-%20https%3a%2f%2fa7medayman6.github.io%2fblog%2fdevops%2fdiving-with-the-whale-docker-series%2fday-v%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23-13.314-11.876-22.304-26.542-24.916-31.026s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z" /></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Compose and Multi-Container Apps on telegram" href="https://telegram.me/share/url?text=Docker%20Compose%20and%20Multi-Container%20Apps&url=https%3a%2f%2fa7medayman6.github.io%2fblog%2fdevops%2fdiving-with-the-whale-docker-series%2fday-v%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47A3.38 3.38.0 0126.49 29.86zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z" /></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://a7medayman6.github.io/>Ahmed Ayman</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z" /></svg></button></a>
<script>let menu=document.getElementById('menu')
menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>